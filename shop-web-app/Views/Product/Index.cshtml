@model IEnumerable<Product>
@using shop_web_app.Enums;
@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}

<section class="py-5 container text-center">
    <div class="row">
        <div class="col-lg-6 col-md-8 mx-auto">
            <h1 class="fw-light">Wybieraj tylko z tego co najlepsze</h1>
     
            @if (User.Identity.IsAuthenticated && User.IsInRole("admin"))
            {
                <p>
                    <a type="button" asp-controller="Product" asp-action="Create" class="btn btn-primary my-2" style="font-size: 20px;">
                        Dodaj nowy produkt
                    </a>
                </p>
            }

        </div>
    </div>
</section>

<div class="text-bg-dark collapse" id="navbarHeader">
    <div class="p-3 container">
        <form method="get" asp-action="Index">
            @{
                string ?gender = Context.Request.Query["gender"];
                string ?priceFrom = Context.Request.Query["priceFrom"];
                string ?priceTo = Context.Request.Query["priceTo"];
                string ?category = Context.Request.Query["category"];
                string ?sortBy = Context.Request.Query["sortBy"];
                string ?isActive = Context.Request.Query["isActive"];
            }
            <div class="row">
                <div class="col">
                    <label class="form-label">Płeć</label>
                    <select name="gender" class="form-select" aria-label="Default select example">
                        @if (gender == null)
                        {
                            <option selected >Dowolna</option>
                            <option value="@ClothingGender.M">@ClothingGender.M.ToFriendlyString()</option>
                            <option value="@ClothingGender.F">@ClothingGender.F.ToFriendlyString()</option>
                        }
                        else
                        {
                            <option value="">Dowolna</option>
                            if(gender == "M")
                            {
                                <option value="@ClothingGender.M" selected>@ClothingGender.M.ToFriendlyString()</option>
                                <option value="@ClothingGender.F">@ClothingGender.F.ToFriendlyString()</option>
                            }
                            else if(gender == "F")
                            {
                                <option value="@ClothingGender.M">@ClothingGender.M.ToFriendlyString()</option>
                                <option value="@ClothingGender.F" selected>@ClothingGender.F.ToFriendlyString()</option>
                            }
                            else
                            {
                                <option value="@ClothingGender.M">@ClothingGender.M.ToFriendlyString()</option>
                                <option value="@ClothingGender.F">@ClothingGender.F.ToFriendlyString()</option>
                            }
                        }
                        
                    </select>
                </div>
                <div class="col">
                    <label class="form-label">Cena od [PLN]</label>
                    <input type="number" name="priceFrom" class="form-control" value="@(priceFrom == null ? "" : priceFrom)"/>
                </div>
                <div class="col">
                    <label class="form-label">Cena do [PLN]</label>
                    <input type="number" name="priceTo" class="form-control" value="@(priceTo == null ? "" : priceTo)" />
                </div>
                <div class="col">
                    <label class="form-label">Kategoria</label>
                    <select name="category"class="form-select mx-auto">
                        @if(!string.IsNullOrEmpty(category))
                        {
                            SubCategory categoryE;
                            if(Enum.TryParse<SubCategory>(category, out categoryE))
                            {
                                <option value="">Wszystkie</option>
                                <option selected value="@category">@categoryE.ToFriendlyString()</option>
                            }
                        }
                        else
                        {
                            <option selected value="">Wszystkie</option>
                        }
                        <optgroup label="Góra">
                            <option value="@SubCategory.TTShirt">T-Shirt</option>
                            <option value="@SubCategory.TShirt">Koszula</option>
                            <option value="@SubCategory.TLongsleeve">Koszulka z długim rękawem</option>
                            <option value="@SubCategory.TCrewneck">Crewneck</option>
                            <option value="@SubCategory.THoodie">Bluza z kapturem</option>
                            <option value="@SubCategory.TSweater">Sweter</option>
                            <option value="@SubCategory.TJacket">Kurtka</option>
                            <option value="@SubCategory.TCoat">Płaszcz</option>
                            <option value="@SubCategory.TSuit">Garnitur</option>
                            <option value="@SubCategory.TDress">Sukienka</option>
                        </optgroup>
                        <optgroup label="Dół">
                            <option value="@SubCategory.BJeans">Dżinsy</option>
                            <option value="@SubCategory.BTrousers">Spodnie</option>
                            <option value="@SubCategory.BShorts">Szorty</option>
                            <option value="@SubCategory.BSkirt">Spódnica</option>
                            <option value="@SubCategory.BLeggings">Legginsy</option>
                            <option value="@SubCategory.BSweatpants">Spodnie dresowe</option>
                        </optgroup>
                        <optgroup label="Akcesoria">
                            <option value="@SubCategory.ABelt">Pasek</option>
                            <option value="@SubCategory.AHat">Czapka</option>
                            <option value="@SubCategory.AScarf">Szalik</option>
                            <option value="@SubCategory.AGloves">Rękawice</option>
                            <option value="@SubCategory.ASunglasses">Okulary przeciwsłoneczne</option>
                            <option value="@SubCategory.AWatch">Zegarek</option>
                            <option value="@SubCategory.ABag">Torebka</option>
                            <option value="@SubCategory.AJewelry">Biżuteria</option>
                        </optgroup>
                        <optgroup label="Buty">
                            <option value="@SubCategory.SSneakers">Sneakersy</option>
                            <option value="@SubCategory.SBoots">Botki</option>
                            <option value="@SubCategory.SSandals">Sandały</option>
                            <option value="@SubCategory.SLoafers">Mokasyny</option>
                            <option value="@SubCategory.SHeels">Obcasy</option>
                            <option value="@SubCategory.SFlats">Płaskie buty</option>
                            <option value="@SubCategory.SSlippers">Kapcie</option>
                            <option value="@SubCategory.SRunningShoes">Buty do biegania</option>
                            <option value="@SubCategory.SWorkShoes">Buty robocze</option>
                        </optgroup>
                    </select>

                </div>
                @{
                    Dictionary<string, string> sortPairs = new Dictionary<string, string>()
                    {
                        {"priceAsc", "Cena (od najniższej)"},
                        {"priceDesc", "Cena (od najwyższej)"},
                        {"alphaAsc", "Alfabetycznie (rosnąco)"},
                        {"alphaDesc", "Alfabetycznie (malejąco)"},
                    };
                }
                <div class="row mt-2">
                    <div class="col">
                        <label class="form-label"><i class="bi bi-sort-down"></i> Sortuj wg</label>
                        <select name="sortBy" class="form-select mx-auto">
                            @if (!string.IsNullOrEmpty(sortBy))
                                            {
                                try
                                {
                                    <option selected value="@sortBy">
                                        @sortPairs[sortBy]
                                    </option>
                                }
                                catch 
                                {
                                    <option selected value="">Bez sortowania</option>
                                }
                            }
                            else
                            {
                                <option selected value="">Bez sortowania</option>
                            }
                            <option value="priceAsc"><i class="bi bi-sort-numeric-down"></i> Cena (od najniższej)</option>
                            <option value="priceDesc"><i class="bi bi-sort-numeric-up-alt"></i> Cena (od najwyższej)</option>
                            <option value="alphaAsc"><i class="bi bi-sort-alpha-down"></i> Alfabetycznie (rosnąco)</option>
                            <option value="alphaDesc"><i class="bi bi-sort-alpha-up-alt"></i> Alfabetycznie (malejąco)</option>
                        </select>
                    </div>
                    @if (User.IsInRole("admin") || User.IsInRole("employee"))
                    {
                        Dictionary<string, string> isActivePairs = new Dictionary<string, string>()
                        {
                            {"activeOnly", "Tylko aktywne"},
                            {"inactiveOnly", "Tylko nieaktywne"},
                            {"all", "Wszystkie"}
                        };
                        <div class="col">
                            <label class="form-label">Aktywność</label>
                            <select name="isActive" class="form-select mx-auto">
                            @if(isActive != null)
                            {
                                try
                                {
                                    <option selected value="@isActive">@isActivePairs[isActive]</option>
                                }
                                catch
                                {
                                    <option selected value="all">Wszystkie</option>
                                }
                            }
                            else
                            {
                                <option selected value="all">Wszystkie</option>
                            }  
                            @foreach(var pair in isActivePairs)
                            {
                                <option value="@pair.Key">@pair.Value</option>
                            }
                            </select>
                        </div>
                    }
                </div>
            </div>
            <div class="mt-3 text-end">
                <button class="btn btn-outline-primary"type="submit">
                    Zastosuj
                </button>
            </div>
        </form>
    </div>
</div>
<div class="mx-auto">
    <div class="container">
        <a class="link-secondary h5" style="text-decoration: none; cursor: pointer;" data-bs-toggle="collapse" data-bs-target="#navbarHeader" aria-controls="navbarHeader" aria-expanded="false" aria-label="Filtry">
            <strong>Filtruj <i class="bi bi-funnel"></i> / Sortuj <i class="bi bi-sort-down"></i></strong>
        </a>
    </div>
</div>

<div class="album py-5 bg-body-tertiary">
    <div class="container">

        <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3">
            @foreach(Product item in Model)
            {
                string url;
                try
                {
                    url = item.ProductVariants.ElementAtOrDefault(0).Photos.ElementAtOrDefault(0).PhotoUrl;
                }
                catch(Exception ex)
                {
                    url = "https://developers.elementor.com/docs/assets/img/elementor-placeholder-image.png";
                }
                <div class="col">
                    <div class="card shadow-sm" style="border-radius: 4px 20px 20px 20px;">
                        <img src=@url alt="Obraz przedstawiający @item.Name" width=100% height=500 style="border-radius: 4px 20px 4px 4px" />
                        <div class="overlay-category" style="position: absolute; top: 0; left: 0; width: 30%; background-color: rgba(0, 0, 0, 0.3); color: white; padding: 5px; text-align: center; border-radius: 4px;">
                            @item.Gender.ToFriendlyString() / @item.SubCategory.ToFriendlyString()
                        </div>
                        <div class="card-body">
                            <p class="card-text">@item.Name</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="btn-group">
                                    <a type="button" asp-controller="Product" asp-action="Details" asp-route-id=@item.Id class="btn btn-sm btn-outline-secondary">Szczegóły</a>
                                    @if (User.Identity.IsAuthenticated && User.IsInRole("admin"))
                                    {
                                        <a type="button" asp-controller="Product" asp-action="Edit" asp-route-id=@item.Id class="btn btn-sm btn-outline-secondary">Edytuj</a>
                                    }
                                </div>
                                <p class="text-body-secondary" style="font-size: 20px">@item.Price PLN</p>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>
